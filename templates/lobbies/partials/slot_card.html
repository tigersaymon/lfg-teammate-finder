<div
    class="list-group-item d-flex justify-content-between align-items-center {% if not slot.player %}bg-light text-muted{% endif %}">

  <div class="d-flex align-items-center gap-3">
    <div class="fw-bold text-secondary">#{{ slot.order }}</div>

    {% if slot.player %}
      <div class="d-flex align-items-center">
        {% if slot.player.avatar %}
          <img src="{{ slot.player.avatar.url }}" class="rounded-circle me-2" width="32" height="32"
               style="object-fit: cover;">
        {% else %}
          <div class="bg-secondary rounded-circle d-flex align-items-center justify-content-center text-white me-2"
               style="width: 32px; height: 32px;">
            <i class="bi bi-person-fill"></i>
          </div>
        {% endif %}

        <div>
          <strong>{{ slot.player.username }}</strong>
          {% if profile %}
            <span class="badge bg-primary ms-1">{{ profile.rank }}</span>
            {% if profile.main_role %}
              <span class="badge bg-secondary ms-1">
                {% if profile.main_role.icon %}<img src="{{ profile.main_role.icon.url }}" width="12">{% endif %}
                {{ profile.main_role.name }}
              </span>
            {% endif %}
          {% else %}
            <span class="badge bg-warning text-dark ms-1">No Profile</span>
          {% endif %}

          {% if slot.player == user %}
            <span class="badge bg-info ms-1">You</span>
          {% endif %}
        </div>
      </div>

    {% else %}
      <div class="d-flex align-items-center">
        <i class="bi bi-dash-circle me-2"></i>
        <span>
            Empty Slot
          {% if slot.required_role %}
            <span class="badge bg-outline-secondary text-dark border ms-1">
                    {% if slot.required_role.icon %}
                      <img src="{{ slot.required_role.icon.url }}" width="12" height="12" class="me-1">
                    {% endif %}
              {{ slot.required_role.name }} Only
                </span>
          {% else %}
            <small class="text-muted ms-1">(Flex)</small>
          {% endif %}
        </span>
      </div>
    {% endif %}
  </div>

  <div class="text-end">
    {% if not slot.player %}
      {% if user.is_authenticated %}
        <button class="btn btn-sm btn-success"
                hx-post="{% url 'lobbies:lobby-join' lobby.game.slug lobby.invite_link slot.id %}"
                hx-swap="outerHTML"
                hx-target="closest .list-group-item">
          Join
        </button>
      {% endif %}
    {% else %}
      {% if user == slot.player and user != lobby.host %}
        <button class="btn btn-sm btn-outline-warning"
                hx-post="{% url 'lobbies:lobby-leave' lobby.game.slug lobby.invite_link slot.id %}"
                hx-swap="outerHTML"
                hx-target="closest .list-group-item">
          Leave
        </button>
      {% endif %}
    {% endif %}
    {% if user == lobby.host and slot.player != user %}
      <button class="btn btn-sm btn-outline-danger"
              hx-post="{% url 'lobbies:lobby-kick' lobby.game.slug lobby.invite_link slot.id %}"
              hx-confirm="Are you sure you want to kick {{ slot.player.username }}?"
              hx-swap="outerHTML"
              hx-target="closest .list-group-item">
        <i class="bi bi-x-lg"></i> Kick
      </button>
    {% endif %}
  </div>
</div>